use customer_behaviour;
select * from customer limit 10;
SELECT
    gender,
    SUM(purchase_amount) AS total_revenue
FROM customer
GROUP BY gender;
SELECT AVG(Purchase_amount) from customer;

-- Q2 Which Customer Used a  Discount coupon but still spent more than the averge purchase amount
select customer_id ,purchase_amount from customer where discount_applied ="Yes" and purchase_amount > (select avg(purchase_amount) from customer);

-- Q3 Which are the Top 5 Products  with the highest average review rating.
select item_purchased ,avg(review_rating) as avg_review from customer  group by item_purchased order by avg_review desc limit 5;

-- Q4 Compare the average Purchase amount between  Standards and Express Shipping
select shipping_type ,avg(purchase_amount) from customer where shipping_type IN ("Standard","Express") group by shipping_type;
 
-- Q5 Do Subscribed Customers spend more? compare average spend and total revenue between Subscribers and non-subscribers.
select subscription_status, count(customer_id) as total_customers, Avg(purchase_amount) as Average_Sepend ,
SUM(purchase_amount) as Total_reveniue 
from customer 
where subscription_status IN ("Yes","No") group by subscription_status;

-- Q6 Which is 5 Product have the highest purchasing  with discount applied.
SELECT 
    item_purchased,
    COUNT(*) AS total_purchases
FROM customer
WHERE discount_applied = 'Yes'
GROUP BY item_purchased
ORDER BY total_purchases DESC
LIMIT 5;

-- Q7 Segment Customers into new returning and loyal based on their total number of previous purchase, and show the count of each segment.
select
case
when previous_purchases < 1 then "New"
when previous_purchases between 2 and 4 then"Returning"
else "loyal"
end as Customer_type,
count(*) as customer_count
from customer
group by customer_type;

 -- Q8 What are the top 3 most purchased  products within each category
 SELECT category,
       item_purchased,
       total_purchases
FROM (
    SELECT
        category,
        item_purchased,
        COUNT(*) AS total_purchases,
        ROW_NUMBER() OVER (
            PARTITION BY category
            ORDER BY COUNT(*) DESC
        ) AS rn
    FROM customer
    GROUP BY category, item_purchased
) t
WHERE rn <= 3;
-- Q9 are customers who are repeat buyers ( more than 5 previous purchases) also  likely to subscribe.
select subscription_status,
 Count(*) as Repeat_Buyers from customer
 where previous_purchases > 5  
 group by subscription_status;
 
 -- Q10 What is the revenue of contribution of each group?
 select age_group, Sum(purchase_amount) as Revenue_Contribution 
from customer group by age_group; 
